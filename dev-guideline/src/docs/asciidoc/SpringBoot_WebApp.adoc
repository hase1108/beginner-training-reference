include::include_all.adoc[]

:toclevels: 5
:sectnums:

[SpringBootWebApp]
= SpringBootでのWebアプリケーション作成

[[SpringBootWebApp_Overview]]
== OverView
<<WebApplication.adoc#WebApplication,WebApplicationとは>>で説明したように、アプリケーションの一形態としてWebアプリケーションは広範に用いられている。 +
本章では、非常に簡単なTodo管理アプリをJavaのフレームワークの一つである**SpringBoot**を用いて開発することを通じて、実際にWebアプリケーションの開発観点を学ぶ。

[[SpringBootWebApp_Design]]
== Webアプリケーションの設計
どのような形式のアプリケーションでも、いきなりアプリケーションを作成する前にアプリケーションがどのような機能を持つのか、どのような仕組みで動作するのかを決定する必要がある。 +
通常、アプリケーションの設計は以下の順番で行われる。 +

* 要件定義 : システムに期待する機能、目的の明確化、システムの実現手段の決定
* 基本設計 : 業務フローの確定、DBのテーブル定義、機能一覧の作成
* 詳細設計 : 実際にプログラムに落とし込むための詳細設計書の作成

本節ではTodoアプリの簡単な設計を通じてそれぞれの段階で何をやるのかを学ぶ。 +
なお、通常は各段階でそれぞれ設計書や仕様書などの書類を作成するが、設計書や仕様書の枠組みなどはそれぞれの現場で異なることが多いため、今回は具体的に設計書は作成せず、どういった内容が記述されるかを記載するに留める。 +
実際の現場では、仕様書や設計書の枠組みに合わせ、記述する内容を微妙に変化させる必要があることを心に留めておいていただきたい。

[[SpringBootWebApp_Design_Business]]
=== 要件定義
通常アプリケーション作成の一番最初に行われるのが**要件定義**である。 +
要件定義は一言でいえば、``クライアントもしくはユーザの要望のまとめ``また``その要望をどのように実現するかの青写真``を作成するステップになる。 +
要件定義を更に細かいステップに分けると以下のようになる。 +

* クライアント/ユーザの要求のヒアリング
* システムの課題/目的/方針の決定
* システム概要/機能/範囲の決定
* UIなどのイメージの構想決定
* システム構成の決定
* 導入/移行/運用/保守方針の決定
* スケジュール/人員の決定
* 成果物の決定
* 作業標準/品質管理方針の決定

見てわかるように、アプリケーション開発において、大きな方針はここで決められる。 +
特に、アプリケーションの持つ機能とシステム構成が決まってしまえば、どのようにアプリケーションを実装するかは概ね決まってしまうため、実装段階でこの部分が大きくぶれるとスケジュールなどに多大な影響を被る場合が多い。 +
しかしながら、往々にしてこの段階で気づかなかった問題が実装段階で判明することもよくある。 +

今回作成するTodoアプリでは、要求のヒアリングや導入/移行方針の決定などは行えないため、以下の内容に絞って記述していく。

* システム概要/機能/範囲の決定
* システム構成の決定

[[SpringBootWebApp_Design_Business_SysOverview]]
==== システム概要
本システムで行いたい機能は以下の通りである。 +

* ユーザはWebクライアントを通じてシステムにアクセスできる
* システムはJSONを利用して情報をやり取りできる
* ユーザは一人しか使用しないため、ログインなどの機能は作成しない
* ユーザはタスクを登録することができる。
** タスクはタイトルとタスクが完了したかどうかの情報を持つ
** 登録できるタスクは5つまでである
** 登録した際のタスクは常に未完了状態である
** タスクは未完了状態から完了状態に変化できるが、逆はできない
** タスクは削除することができる
* ユーザはタスクの一覧を取得することができる
** タスクの一覧は完了未完了問わずすべて表示される
* タスクの情報はDBには保存せず、アプリケーション内で保持する

[[SpringBootWebApp_Design_Business_SysConstitution]]
==== システム構成
本システムは最終的にはAWS上のEC2インスタンス上で動作させる。 +
最終的な構成は以下のようになる。

.システム構成図
[#Diagram]
image::SpringBoot_WebApp/SystemConfigDiagram.png[システム構成図]

AWSの構成についての詳しい説明は後述する。 +
なお、あくまで学習用途用のアプリケーションの為、この構成のまま実務に使用することはできない。

[[SpringBootWebApp_Design_Basic]]
=== 基本設計
要件定義が終了した後、要件定義で確認した仕様をもとに業務の整理や利用するDBのテーブル設計などを行うのが基本設計になる。 +
基本設計をより細かいステップに分けると以下のようなタスクがある。 +

* 業務フロー作成
* 機能一覧作成
* 画面/帳票レイアウト作成
* 画面遷移図作成
* ER図/CRUD図作成
* システムインターフェース作成

本システムはREST APIを実装したWebアプリケーションであり、またDBを用いない為、ER図などは作成しない、以下の項目について簡単に設計する。 +

* 業務フロー
* 機能一覧
* システムインターフェース

[[SpringBootWebApp_Design_Basic_Flow]]
==== 業務フロー
業務フローは要件定義で決定した各仕様/機能に対して実際にどのような処理をどのような順番で、誰/何に対して行うかをフローチャートとして図示したものになる。 +
システムの規模によっては関連する部署、システムが非常に大きくなることもあるため、このような業務フローを作成して関係者間で合意を得る必要がある。 +

本来であれば、**スイムレーン**と呼ばれる部署/担当ごとにどの機能を担当するかを示す記法を用いることが多いが、今回作成するTodoアプリは利用するユーザとWebアプリケーションしか存在しないため省略する。 +

.タスク投稿
[#CreateTask]
image::SpringBoot_WebApp/Create_Task.png[タスク投稿]

.タスク取得
[#ReadTask]
image::SpringBoot_WebApp/Read_Task.png[タスク取得]

.全タスク取得
[#ReadTaskList]
image::SpringBoot_WebApp/Read_Task_List.png[全タスク取得]

.タスク削除
[#DeleteTask]
image::SpringBoot_WebApp/Delete_Task.png[タスク削除]

.タスク更新
[#UpdateTask]
image::SpringBoot_WebApp/Put_Task.png[タスク更新]


フローチャートなどを作成するツールは様々存在するが、今回はlink:https://plantuml.com/ja/[plantUML]のアクティビティ図作成機能を利用して記述している。 +
Webアプリケーションではlink:https://app.diagrams.net/[draw.io]などが知られるが、Webアプリケーションであるため業務上センシティブな情報を記述する必要がある場合は使用しないこと。

[[SpringBootWebApp_Design_Basic_Features]]
==== 機能一覧
業務フローを作成した後、開発対象となる機能を一覧として記述し、システム化の対象を明確にする。 +
本来であれば、一つのシステム内で共通的に利用する機能などがあるため、そういった部分の重複を防ぐためにも行う必要があるが、今回作成するシステムは機能がシンプルで業務フロー自体がほぼ機能を示しているためため作成しない。


[[SpringBootWebApp_Design_Basic_IF]]
==== インターフェース
機能一覧を整理したのちとりかかるのが**インターフェース**部分の設計である。
インターフェースとは、システムにおけるユーザとの入出力部分に相当する。 +
インターフェースを設計する際はそのインターフェース部分に対して入出力先や入出力を行うデータの種類を設計することになる。 +
同じような言葉として**エンドポイント**という語もある。 +

本システムでは、ユーザはシステムの特定のパスに対してアクセスすることで機能を利用することになるため、今回の場合はパスがインターフェースに相当する。 +
通常、RESTの思想で作成したシステムのインターフェースは**REST API**と呼ばれる。 +
本システムのインターフェースは簡単にまとめると以下のようになる。 +
なお、REST APIのURL設計は様々な考え方が存在する為、システムで決定した方針に従って決定すること。

.Todoアプリインターフェース
[cols="10,10,20,40,50", options="header"]
|===
|項目名
|パス
|メソッド
|入力項目
|出力項目

|タスク投稿
|/todos
|POST
|task:String
|task_id:int +
task:String +
isFinished:boolean

|タスク取得
|/todos/{id}
|GET
|-
|task_id:int +
task:String +
isFinished:boolean

|タスクリスト取得
|/todos
|GET
|-
|task_id:int +
task:String +
isFinished:boolean

|タスク削除
|/todos/{id}
|DELETE
|-
|-

|タスク更新
|/todos/{id}
|PUT
|-
|-
|===

[[SpringBootWebApp_Design_Detail]]
=== 詳細設計
基本設計書で大まかにシステムで開発を行う範囲や機能が決まったところで、それを実際にプログラムに落とし込むために詳細設計を行う必要がある。 +
詳細設計ではよりプログラム的な考え方に寄っていくことになり、主に以下のような事柄について設計する。 +

* 機能設計書
* DBの物理設計書
* メッセージ
* 画面項目
* 例外設計
* セキュリティ対策

詳細設計所は、製造段階だけでなく運用管理や保守の際も用いられることが多い。 +
今回の開発では詳細設計書を作成するほどの規模でもないため省略する。 +