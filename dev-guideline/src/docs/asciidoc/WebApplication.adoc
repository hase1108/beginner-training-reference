include::include_all.adoc[]

:toclevels: 5
:sectnums:

[WebApplication]
= WebApplicationとは

[WebApplication_Overview]
== Overview

アプリケーションの形態として、各ユーザのコンピュータに直接インストールして利用するようなアプリケーション(ネイティブアプリ)が多く存在するが、現在業務用のアプリケーションなどでもウェブ技術を基盤とし、処理はサーバで行い結果をユーザに表示するようなWebアプリケーションが多く開発されている。 +
本章では、JavaによるWebアプリケーションを作成する前段階として、Webアプリケーションを構成する技術などを説明する。

[WebApplication_WhatIs]
== WebApplicationとは
<<WebApplication_Overview,Overview>>で説明したように、Webアプリケーションはウェブ技術を基盤としたアプリケーションである。 +
ウェブ技術を基盤としているため、アプリケーション利用者はインターネットを経由してアプリケーションを利用する。 +
この形態のアプリケーションを利用するメリットとしては、以下の事があげられる。

* ユーザのコンピュータにアプリケーションを一々ダウンロードする必要がない
* インターネットと端末が存在すれば、外出先でも利用できる
* 各ユーザの実行環境をあまり気にする必要がない

一方デメリットとしては

* インターネットがなければ基本的に利用できない
* インターネット回線の障害などアプリケーション由来でない理由での障害が発生する
* アプリケーションのレスポンスが回線速度などにも依存してしまう

などが上げられる。 +
必ずしもウェブアプリケーションが適切ではない場合も多いため、システムの要件を勘案して適当な構成をとる必要がある。

[WebApplication_WhatIs_SysConfig]
=== システム構成

Webアプリケーションでは、アプリケーション本体とユーザの端末があれば成立するネイティブアプリケーションと異なり、ユーザの端末以外に実際に各種処理を行うサーバなどのシステムを構築する必要がある。 +
以下に最も単純なユーザが要求した何らかの静的コンテンツ(テキストや画像など)を返却するWebアプリケーションのシステム構成を示す。 +
なお、インターネットを経由した通信方式については、<<HowInternetWorks.adoc#HowInterWorks_Communication,ネットワーク通信手法>>を参照すること。

.シンプルなWebアプリケーション
[#SimpleWebApp]
image::WebApp/SimpleWebApp.png[シンプルなWebアプリケーション]

この形式では、ユーザはユーザのコンピュータに存在する何らかのWebクライアントソフトに対して要求を発行する。 +
要求を受け付けたWebクライアントソフトは、入力された情報に従いインターネットを経由して指定されたWebサーバに対して要求を行う。 +
Webサーバでは、物理的なマシン上でWebサーバの機能を持つアプリケーション(ミドルウェア)が動作しており、要求を受けた静的コンテンツをレスポンスとしてWebクライアントに返却する。 +
Webクライアントは返却されたデータをユーザに対して表示することで一連の動作が完了する。 +
この構造では、Webサーバ上では基本的にJavaやその他のプログラミング言語を動作させる事ができないため、リクエストに応じた動的な処理やビジネスロジックを実行することができない。 +
そこで、現在主流な方式として**Web三層構造**というものがよく用いられる。 +
以下にWeb三層構造の概要図を示す。 

.Web三層構造
[#Three-layerStructure]
image::WebApp/Three-layerStructure.png[Web三層構造]

Web三層構造では、WebサーバにWebクライアントからリクエストがインターネット経由で届くところまでは一緒だが、その後ろにプログラムを配置しビジネスロジックなどを行うアプリケーションサーバと様々なデータを保存し、適宜取り出すデータベースサーバが配置され、それそれ連動して処理を行うことが異なる。 +
この三層構造のメリットとしては以下があげられる。 +

* それぞれのサーバの責任分界点が明確になる
* DBなどは直接インターネットに公開されるとセキュリティに問題がある
* ミドルウェアやハードウェアをそれぞれ選択することができる

なお、各サーバ間の通信プロトコルは共通ではなく、各ミドルウェアで異なる。

[WebApplication_WhatIs_Tech]
=== 構成する技術

本節では、Webアプリケーションを構築する上で基盤となる各種技術をそれぞれ説明していく。

[WebApplication_WhatIs_Tech_WebServer]
==== Webサーバ

Webサーバは前述したように、ユーザからHTTPによるリクエストを受付け、内部に保持する静的コンテンツをユーザに返却したり、APサーバへの処理を橋渡しする窓口のような役割を果たす。 +
Webサーバは通常ハードとソフト両面で様々な特徴を持つ。 +

ハード

* 複数ユーザの同時アクセスに耐えられるメモリ
* アクセス処理ができるCPU
* 静的コンテンツを保持するHDD
* 長時間起動したままにできる耐久性

ソフト

* HTTP/HTTPSを理解できる
* APサーバと通信可能なプロトコルが理解できる

なお、性能にこだわらなければ各個人のコンピュータにソフトウェアをインストールしてWebサーバとして運用することもできる。 +

Webサーバのソフトウェアとして以下のものがあげられる。

* https://httpd.apache.org/[Apache HTTP Server]
* https://www.nginx.com/[Nginx]

[WebApplication_WhatIs_Tech_APServer]
==== APサーバ

APサーバは前述したように、リクエストに対してプログラムを動かし、適当なビジネスロジックなどを働かせる目的を持つサーバである。 +
APサーバのハードとしての特徴はWebサーバとあまり大差ないが、ソフトとしては以下の特徴がある。 +

* 実装するプログラムが実行可能な環境を持つ
* DBと連携を行うシステムであればDBと通信可能なプロトコルを理解できる

これもWebサーバと同様に、個人のコンピュータに環境を構築すればAPサーバとして利用することもできる。 +

APサーバ用のソフトウェアとして以下のものが上げられる。

* http://tomcat.apache.org/[Apache Tomcat]
* https://wildfly.org/[WildFly]

なお、Tomcat/WildFlyに関しては簡易的なWebサーバとしての機能も持つ。

[WebApplication_WhatIs_Tech_HttpHttps]
==== HTTP/HTTPS

Webアプリケーションのシステムにおいて、ユーザとサーバの通信はHTTP/HTTPSによって行われる。 +
HTTP/HTTPSの具体的な通信方法については<<HowInternetWorks.adoc#HowInterWorks_Communication_Protcol_HTTP,HTTP(Hypertext Transfer Protocol)>>などで説明をしているが、Webアプリケーションの開発において意識する部分としては以下のことが上げられる。 +

* URL
* ヘッダーとボディ
* メソッド

簡単にそれぞれ説明する。

[WebApplication_WhatIs_Tech_HttpHttps_URL]
===== URL
URLは以下のような形式をとり、Webアプリケーションにおいて**リソースの場所**を示す重要な要素である。 +

----
http://<<(ホスト名 + ドメイン名) = FQDN>>/<<パス>>
----

FQDNはユーザからリクエストを送るサーバの場所を示し、パスはそのサーバに保存してある静的コンテンツが存在する場所であったり、サーバで動作しているアプリケーションを動作させるためのエンドポイントを指定する。 +
簡単な図を以下に示す。 +

.URL概要
[#URL]
image::WebApp/URL.png[URL概要]

URLの設計は特に後述するRESTの思想に基づいたWebアプリケーションを作成する場合は重要になる。 +

[WebApplication_WhatIs_Tech_HttpHttps_Method]
===== Method
URLでサーバの場所やリソースの場所は特定できるが、具体的に指定したリソースに対してどのような動作を要求するかを指定するのが**メソッド**になる。 +
メソッドはHTTPのバージョンによって規定されているものが違うが、代表的には以下の4つが良く用いられ、このメソッドでCRUDを表現する。 +

.メソッド
[cols="30,70", options="header"]
|===
|メソッド名
|概要

|POST
|ユーザから情報を渡してリソースを作成する。

|GET
|サーバにリソースを要求する。

|PUT
|ユーザから情報を渡してサーバ上のリソースを置き換える。

|DELETE
|サーバ上のリソースを削除する。
|===

通常、画面が表示されるようなWebアプリケーションは画面をGETで要求して表示することが多い。 +

GET/POSTは最も使われる頻度が高いメソッドだが、使い分けを意識する必要があることもある。 +
GETはサーバに対してリソースを要求するが、その際にリソースの情報などのデータを**パスに含めて**送信することができる。 +
その際は以下のような形式でデータを記述し、クエリパラメータと呼ばれる。 +

----
http://hoge.hoge/fuga/fuga.html?key=value
----

対してPOSTも前述のようにサーバに情報を渡す事ができるが、その際は後述する**Body**に情報を記述して送信する。 +

どちらも情報を渡してレスポンスを受けることができるが、GETで情報を送信する場合はURLにその情報が記述されるため、クリティカルな情報を取り扱うことができない。 +
取り扱う内容を勘案し、使用するメソッドを考える必要がある。

[WebApplication_WhatIs_Tech_HttpHttps_HeaderBody]
===== Header/Body
前述したように、URLでサーバ/リソースの場所を指定し、メソッドで要求する操作を指定することで、Webアプリケーションは成立するが、実際にリクエスト及びレスポンスの情報はHeaderとBodyという形式でやり取りが行われる。 +

通常、Headerは基本的なメソッドやパスの情報だけでなく、ユーザやサーバの情報や制御用の各種パラメータをセットして、リクエストレスポンス全体の制御を行う。 +
対してボディはユーザから送信したいデータを記述したり、サーバから送信される静的コンテンツやデータが格納される。 +

[WebApplication_WhatIs_Tech_Browser]
==== Webブラウザ
WebブラウザはWebアプリケーションを利用するために使用されるWebクライアントの一種であり、GoogleのChromeやMicrosoftのEdgeなどがよく知られる。 +

WebブラウザはWebクライアントとしてユーザの入力した情報に従ってWebサーバに対してリクエストを行ったり、レスポンスを受け取ったりすることができるが、特徴の一つとして、後述のhtmlで記述したテキストをレンダリングする機能を持つ。 +
レンダリングはhtmlで記述されたタグや画像へのリンクやスクリプトなどの情報を解釈/理解し、指定されたようにブラウザに描画させる機能であり、単純な文字列であるhtmlを人間が理解しやすいような形式に表示させることができる。 +

[WebApplication_WhatIs_Tech_Html]
==== html
htmlは**Hyper Text Markup Language**の略で、Webページを作成するためのマークアップ言語の一種である。 +
通常我々がよく見るWebページの多くはこの形式で記述される。 +
HTMLは文字列で成り立ち、表示するべきデータとそれを修飾する**タグ**で構成される。 +


タグは特定の文字列を囲う形で配置し、囲まれた文字列に対して何らかの情報や操作を行うことを示す。 +
例えば``リンクタグ(<a href=""></a>)``と呼ばれるタグでURLの規則に従った文字列を囲めば、ブラウザで表示した場合に他のリソースへのリンクになる。 +
その他文字列の色などを指定するタグで囲めば、ブラウザで表示した際に文字の色が指定のように変化して表示される。 +

[WebApplication_WhatIs_Tech_Session]
==== セッション
通常Webアプリケーションはユーザからのリクエストに対してWebサーバがレスポンスを返却する一往復で処理が終了する状態を持たない``ステートレス``なシステムである。 +
しかしながら、ユーザがログインしている間は会員メニューを表示させたりするような、情報を持つ``ステートフル``なシステムが必要な場合は多い。 +

そのような場合に利用するのが**セッション**と呼ばれる状態を保持する機能である。
セッションの実装方法は様々あるが、有名なものは必要な情報をユーザ側に持たせる**Cookie**である。 +
Cookieでは通常固有のIDを保有し、サーバ側でそのIDを検証する処理を行うことでステートレスなやり取りが可能になる。 +

[WebApplication_REST]
== REST

RESTはWebアプリケーションの設計指針の一つであり、リソースを示すURLに対してHTTPでアクセスすると、そのアクセスに対するレスポンスとして後述するJSONなどのメッセージが送付されてくるようなシステムである。 +

Webページを表示するようなWebアプリケーションとは異なり、画面の描画は通常行わない。 +

詳しい説明は後述する。

[WebApplication_REST_Tech]
=== 構成する技術

本節では、RESTのアプリケーションを構築する上で基盤となる技術を説明していく。

[WebApplication_WhatIs_Tech_Json]
==== JSON
RESTの設計指針で作成されたシステムでデータをやり取りする際によく利用されるフォーマットである。 +
基本的には``{key : value}``形式で表現され比較的人間にとっても読みやすいデータ形式である。 +
